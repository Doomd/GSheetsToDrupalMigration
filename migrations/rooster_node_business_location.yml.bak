id: rooster_node_business_location
label: "Doomd migration of Business Location Rooster Data from Google Sheets to Drupal"
migration_tags:
  - Rooster Business
  - Doomd Migration
source:
  constants:
    PHOTO_DESCRIPTION_PREFIX: "Photo of"

  plugin: url
  data_fetcher_plugin: http
  data_parser_plugin: google_sheets
  urls: "https://spreadsheets.google.com/feeds/list/1muU787iBWZXaAPqKo2hULs5wJFUn87x_mu5pruy8qqE/1/public/values?alt=json"
  fields:
    - name: src_unique_id
      label: "Unique ID"
      selector: uniqueid
    - name: src_name
      label: "Name"
      selector: name
    - name: src_pb_ref
      label: "Business Parent Ref ID"
      selector: pbref
    - name: src_uid
      label: "User ID"
      selector: userid
    - name: src_photo_id
      label: "Photo ID"
      selector: photoid
    - name: src_bus_type
      label: "Business Type"
      selector: businesstype
    - name: address1
      label: "Address1"
      selector: "address1"
    - name: address2
      label: "Address2"
      selector: "address2"
    - name: city
      label: "City"
      selector: "city"
    - name: state
      label: "State"
      selector: "state"
    - name: postal_code
      label: "Postal Code"
      selector: "postalcode"
  ids:
    src_unique_id:
      type: integer
process:
  title: src_name
  uid:
    -
      plugin: migration_lookup
      migration: rooster_users
      source: src_uid
    -
      plugin: default_value
      default_value: 1
  field_images_test/target_id:
    plugin: migration_lookup
    migration: rooster_file_image
    source: src_photo_id
  field_images_test/alt:
    plugin: concat
    source:
      - constants/PHOTO_DESCRIPTION_PREFIX
      - src_name
    delimiter: " "

  field_media_test/target_id:
    plugin: migration_lookup
    migration: rooster_file_image_to_media
    source: src_photo_id
  field_media_test/alt:
    plugin: concat
    source:
      - constants/PHOTO_DESCRIPTION_PREFIX
      - src_photo_id
    delimiter: " "

  field_business_name:
    plugin: migration_lookup
    migration: rooster_node_parent_business
    source: src_pb_ref

  field_business_type:
    - plugin: skip_on_empty
      source: src_bus_type
      method: process
      message: "No src_bus_type listed."
    - plugin: explode
      delimiter: ","
    - plugin: callback
      callable: trim
    - plugin: entity_generate
      entity_type: taxonomy_term
      value_key: name
      bundle_key: vid
      bundle: business_type

  field_address/country_code:
    plugin: default_value
    default_value: "US"
  field_address/address_line1: address1
  field_address/address_line2: address2
  field_address/locality: city
  field_address/administrative_area: state
  field_address/postal_code: postal_code
  # Unused fields that may have to be declared here anyway:
  field_address/langcode:
    plugin: default_value
    default_value: ""
  field_address/dependent_locality:
    plugin: default_value
    default_value: null
  field_address/sorting_code:
    plugin: default_value
    default_value: null
  field_address/organization:
    plugin: default_value
    default_value: null
  field_address/given_name:
    plugin: default_value
    default_value: null
  field_address/additional_name:
    plugin: default_value
    default_value: null
  field_address/family_name:
    plugin: default_value
    default_value: null

destination:
  plugin: "entity:node"
  default_bundle: business_branch
migration_dependencies:
  required:
    - rooster_file_image
    - rooster_node_parent_business
    - rooster_file_image_to_media
    - rooster_users
  optional: []
